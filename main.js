/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var v=Object.defineProperty;var N=Object.getOwnPropertyDescriptor;var L=Object.getOwnPropertyNames;var O=Object.prototype.hasOwnProperty;var F=(n,t)=>{for(var e in t)v(n,e,{get:t[e],enumerable:!0})},I=(n,t,e,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of L(t))!O.call(n,o)&&o!==e&&v(n,o,{get:()=>t[o],enumerable:!(i=N(t,o))||i.enumerable});return n};var U=n=>I(v({},"__esModule",{value:!0}),n);var j={};F(j,{default:()=>y});module.exports=U(j);var V=require("obsidian");var c=require("obsidian"),M={enabled:!1,maskMode:"blur",revealMode:"word",excludeHeaders:!0,revealSelection:!0},f=class extends c.PluginSettingTab{constructor(t,e){super(t,e),this.plugin=e}display(){let{containerEl:t}=this;t.empty(),new c.Setting(t).setName("Enable text hider").setDesc("Turn masking on/off. For optimal use, set a hotkey for the toggle command. You can also bind hotkeys for enable/disable. All commands are also available from the command palette.").addToggle(e=>e.setValue(this.plugin.settings.enabled).onChange(async i=>{this.plugin.settings.enabled=i,await this.plugin.saveSettings(),this.plugin.notifySettingsChanged()})),new c.Setting(t).setName("Masking & reveal").setHeading(),new c.Setting(t).setName("Mask mode").setDesc("How hidden text is shown (hide is cleanest, blur is softer, password may vary by theme).").addDropdown(e=>{e.addOption("hide","Hide"),e.addOption("blur","Blur"),e.addOption("password","Password"),e.setValue(this.plugin.settings.maskMode),e.onChange(async i=>{this.plugin.settings.maskMode=i,await this.plugin.saveSettings(),this.plugin.notifySettingsChanged()})}),new c.Setting(t).setName("Reveal mode").setDesc("What stays readable at the cursor.").addDropdown(e=>{e.addOption("word","Current word"),e.addOption("letter","Current letter"),e.setValue(this.plugin.settings.revealMode),e.onChange(async i=>{this.plugin.settings.revealMode=i,await this.plugin.saveSettings(),this.plugin.notifySettingsChanged()})}),new c.Setting(t).setName("Exceptions & behavior").setHeading(),new c.Setting(t).setName("Exclude headers").setDesc("Keep Markdown headers (#, ##, ###) visible.").addToggle(e=>e.setValue(this.plugin.settings.excludeHeaders).onChange(async i=>{this.plugin.settings.excludeHeaders=i,await this.plugin.saveSettings(),this.plugin.notifySettingsChanged()})),new c.Setting(t).setName("Reveal selected text").setDesc("Selected text becomes visible while selected.").addToggle(e=>e.setValue(this.plugin.settings.revealSelection).onChange(async i=>{this.plugin.settings.revealSelection=i,await this.plugin.saveSettings(),this.plugin.notifySettingsChanged()}))}};var P=require("obsidian"),T=require("@codemirror/state");var m=require("@codemirror/view");var w=require("@codemirror/view"),C=require("@codemirror/state");function u(n){let t=n.filter(i=>i.to>i.from).slice().sort((i,o)=>i.from-o.from||i.to-o.to),e=[];for(let i of t){let o=e[e.length-1];!o||i.from>o.to?e.push({...i}):o.to=Math.max(o.to,i.to)}return e}function k(n,t){let e=u(n),i=u(t),o=[];for(let a of e){let s=a.from;for(let l of i){if(l.to<=s)continue;if(l.from>=a.to)break;let r=Math.max(s,a.from),g=Math.min(l.from,a.to);if(g>r&&o.push({from:r,to:g}),s=Math.max(s,l.to),s>=a.to)break}s<a.to&&o.push({from:s,to:a.to})}return o}function E(n,t){let e=n.selection.main.head;if(t==="letter")return e<n.doc.length?[{from:e,to:e+1}]:e>0?[{from:e-1,to:e}]:[];let i=n.doc.lineAt(e),o=e-i.from,a=r=>/[A-Za-z0-9_]/.test(r),s=o;for(;s>0&&a(i.text.charAt(s-1));)s--;let l=o;for(;l<i.text.length&&a(i.text.charAt(l));)l++;return l<=s?[]:[{from:i.from+s,to:i.from+l}]}function R(n){return/^\s{0,3}#{1,6}\s/.test(n)}function x(n,t,e){if(!t)return w.Decoration.none;let i=new C.RangeSetBuilder,o=n.state,a=E(o,e.revealMode),s=e.revealSelection?o.selection.ranges.filter(r=>!r.empty).map(r=>({from:Math.min(r.from,r.to),to:Math.max(r.from,r.to)})):[],l=u([...a,...s]);for(let r of n.visibleRanges){let g=r.from;for(;g<=r.to;){let p=o.doc.lineAt(g);if(p.from>r.to)break;if(!(e.excludeHeaders&&R(p.text))){let h={from:p.from,to:p.to},D=l.filter(d=>d.to>h.from&&d.from<h.to).map(d=>({from:Math.max(d.from,h.from),to:Math.min(d.to,h.to)})),H=k([h],D),A=e.maskMode==="hide"?"privacy-mask-hide":e.maskMode==="password"?"privacy-mask-password":"privacy-mask-blur";for(let d of H)d.to<=d.from||i.add(d.from,d.to,w.Decoration.mark({class:A}))}if(g=p.to+1,g===p.from)break}}return i.finish()}function S(n){let{enabled:t,settings:e}=n,i=m.EditorView.editorAttributes.of({class:t?"privacy-mode-enabled":""}),o=m.ViewPlugin.fromClass(class{constructor(s){this.decorations=x(s,t,e)}update(s){if(!t){this.decorations=m.Decoration.none;return}(s.docChanged||s.selectionSet||s.viewportChanged)&&(this.decorations=x(s.view,t,e))}},{decorations:a=>a.decorations});return[i,o]}var b=class{constructor(t){this.compartment=new T.Compartment;this.plugin=t,this.enabled=t.settings.enabled,this.baseExtension=this.compartment.of(S({enabled:this.enabled,settings:this.plugin.settings})),this.plugin.registerEditorExtension(this.baseExtension);let e=this.plugin.app.workspace.on("active-leaf-change",()=>this.apply("settings-change")),i=this.plugin.app.workspace.on("layout-change",()=>this.apply("settings-change"));this.plugin.register(()=>this.plugin.app.workspace.offref(e)),this.plugin.register(()=>this.plugin.app.workspace.offref(i))}syncFromSettings(t){this.enabled=this.plugin.settings.enabled,this.apply(t.reason)}toggleEnabled(){this.setEnabled(!this.enabled)}setEnabled(t){this.enabled!==t&&(this.enabled=t,this.plugin.settings.enabled=t,this.plugin.saveSettings(),this.apply("command"))}onSettingsChanged(){this.apply("settings-change")}apply(t){let e=S({enabled:this.enabled,settings:this.plugin.settings}),i=this.compartment.reconfigure(e);for(let o of this.getAllMarkdownEditorViews()){let a=this.getEditorView(o);a&&a.dispatch({effects:i})}}*getAllMarkdownEditorViews(){let t=this.plugin.app.workspace.getLeavesOfType("markdown");for(let e of t){let i=e.view;i instanceof P.MarkdownView&&(yield i)}}getEditorView(t){return _(t.editor)}};function _(n){if(!n||typeof n!="object")return null;let e=n.cm;return e&&typeof e=="object"&&"state"in e?e:null}var y=class extends V.Plugin{async onload(){await this.loadSettings(),this.privacy=new b(this),this.addSettingTab(new f(this.app,this)),this.registerCommands(),this.privacy.syncFromSettings({reason:"startup"})}registerCommands(){this.addCommand({id:"toggle-privacy-mode",name:"Toggle privacy mode",callback:()=>this.privacy.toggleEnabled()}),this.addCommand({id:"enable-privacy-mode",name:"Enable privacy mode",callback:()=>this.privacy.setEnabled(!0)}),this.addCommand({id:"disable-privacy-mode",name:"Disable privacy mode",callback:()=>this.privacy.setEnabled(!1)})}notifySettingsChanged(){this.privacy.onSettingsChanged()}async loadSettings(){this.settings=Object.assign({},M,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}};
